define(["react","lodash","@grafana/data","@grafana/ui","@grafana/runtime"],(function(e,t,a,n,r){return function(e){var t={};function a(n){if(t[n])return t[n].exports;var r=t[n]={i:n,l:!1,exports:{}};return e[n].call(r.exports,r,r.exports,a),r.l=!0,r.exports}return a.m=e,a.c=t,a.d=function(e,t,n){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(a.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)a.d(n,r,function(t){return e[t]}.bind(null,r));return n},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="/",a(a.s=5)}([function(t,a){t.exports=e},function(e,a){e.exports=t},function(e,t){e.exports=a},function(e,t){e.exports=n},function(e,t){e.exports=r},function(e,t,a){"use strict";a.r(t);var n=a(3),r=a(2),l=a(4),o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a])})(e,t)};function i(e,t){function a(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(a.prototype=t.prototype,new a)}var s=function(){return(s=Object.assign||function(e){for(var t,a=1,n=arguments.length;a<n;a++)for(var r in t=arguments[a])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};function u(e,t,a,n){return new(a||(a=Promise))((function(r,l){function o(e){try{s(n.next(e))}catch(e){l(e)}}function i(e){try{s(n.throw(e))}catch(e){l(e)}}function s(e){var t;e.done?r(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(o,i)}s((n=n.apply(e,t||[])).next())}))}function c(e,t){var a,n,r,l,o={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return l={next:i(0),throw:i(1),return:i(2)},"function"==typeof Symbol&&(l[Symbol.iterator]=function(){return this}),l;function i(l){return function(i){return function(l){if(a)throw new TypeError("Generator is already executing.");for(;o;)try{if(a=1,n&&(r=2&l[0]?n.return:l[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,l[1])).done)return r;switch(n=0,r&&(l=[2&l[0],r.value]),l[0]){case 0:case 1:r=l;break;case 4:return o.label++,{value:l[1],done:!1};case 5:o.label++,n=l[1],l=[0];continue;case 7:l=o.ops.pop(),o.trys.pop();continue;default:if(!(r=o.trys,(r=r.length>0&&r[r.length-1])||6!==l[0]&&2!==l[0])){o=0;continue}if(3===l[0]&&(!r||l[1]>r[0]&&l[1]<r[3])){o.label=l[1];break}if(6===l[0]&&o.label<r[1]){o.label=r[1],r=l;break}if(r&&o.label<r[2]){o.label=r[2],o.ops.push(l);break}r[2]&&o.ops.pop(),o.trys.pop();continue}l=t.call(e,o)}catch(e){l=[6,e],n=0}finally{a=r=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}([l,i])}}}function p(e,t){var a="function"==typeof Symbol&&e[Symbol.iterator];if(!a)return e;var n,r,l=a.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(n=l.next()).done;)o.push(n.value)}catch(e){r={error:e}}finally{try{n&&!n.done&&(a=l.return)&&a.call(l)}finally{if(r)throw r.error}}return o}function m(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(p(arguments[t]));return e}var f=a(1),d=function(){function e(e,t){this.key=e,this.value=t.toString()}return e.prototype.getValue=function(){return[this.key,this.value].join("=")},e}(),h=function(){function e(e,t,a,n){void 0===n&&(n="^"),this.condition=n,this.field=e,this.operator=t,this.value=a}return e.prototype.toString=function(){return(""+this.field+this.operator+this.value).trim()},e}(),v=function(){function e(e,t,a,n,r,l,o){void 0===l&&(l=""),void 0===o&&(o="desc"),this.tableName="",this.queryParams=[],this.api=e,this.tableName=t;var i=[this.getNormalizedSysParmQuery(a)+"^"].filter((function(e){return"^"!==e}));n.forEach((function(e,t){var a=t===n.length-1?"":e.condition||"^";i.push(encodeURIComponent((""+e.field+e.operator+e.value+a).trim()))})),l&&i.push(("asc"===o?"^ORDERBY":"^ORDERBYDESC")+l.trim()),this.queryParams.push(new d("sysparm_query",i.join("").replace(/\^\^/g,"^"))),this.queryParams.push(new d("sysparm_display_value",r))}return e.prototype.getNormalizedSysParmQuery=function(e){return(e+"").trim().replace(/\^OR\n/g,"^OR").replace(/\^\n/g,"^").replace(/\n/g,"^")},e.prototype.getUrl=function(){switch(this.api){case"doc":return"/api/now/doc/"+this.tableName;case"table":return"/api/now/table/"+this.tableName+"?"+this.queryParams.map((function(e){return e.getValue()})).join("&");case"stats":return"/api/now/stats/"+this.tableName+"?"+this.queryParams.map((function(e){return e.getValue()})).join("&")}},e}(),b=function(e){function t(t,a,n,r,l,o,i){void 0===r&&(r=10);var s=e.call(this,"table",t,n,l,"all",o,i)||this;return a.length>0&&a[0]&&"*"!==a[0]&&s.queryParams.push(new d("sysparm_fields",a.join(","))),s.queryParams.push(new d("sysparm_limit",r.toString())),s}return i(t,e),t}(v),y=function(e){function t(t,a,n,r,l){void 0===r&&(r="true");var o=e.call(this,"stats",t,n,l,"all","","asc")||this;return o.queryParams.push(new d("sysparm_group_by",a.join(","))),o.queryParams.push(new d("sysparm_count",r)),o}return i(t,e),t}(v),g=new(function(){function e(e){this.table="incident",this.type="table",this.orderByDirection="asc",this.table=e.table||"incident",this.type=e.type||"table",this.fields=e.fields||[],this.query=e.query||"",this.filters=e.filters||[],this.orderByDirection=e.orderByDirection||"asc",this.orderBy=e.orderBy||"",this.groupBy=e.groupBy||[],this.limit=e.limit||25}return e.prototype.getUrl=function(){if("table"===this.type){var e=(this.fields&&"*"!==this.fields[0]?this.fields||"opened_at,number,short_description,sys_created_by,severity,category,state,priority".split(","):[]).filter(Boolean).map((function(e){return e.trim()}));return new b(this.table,e,this.query,this.limit,this.filters,this.orderBy,this.orderByDirection).getUrl()}if("stats"===this.type){var t=(this.groupBy?this.groupBy:[]).filter(Boolean).map((function(e){return e.trim()}));return new y(this.table,t,this.query,"true",this.filters).getUrl()}return""},e}())({table:"incident",type:"stats",fields:"opened_at,number,short_description,sys_created_by,severity,category,state,priority".split(","),query:"",groupBy:"state".split(","),orderBy:"opened_at",orderByDirection:"desc",limit:10});function w(e){return(w="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var E=function(){function e(e){var t=this;this.output={columns:[],rows:[],type:"table"},e.filter((function(e){return e&&e.result&&e.result.data&&e.result.data.result})).forEach((function(e){t.query=e.query,e&&e.query&&e.query.servicenow&&"stats"===e.query.servicenow.type?e.result.data.result.stats?t.parseResultsAsSingleStat(e):t.parseResultsAsMultiStat(e):t.parseResultsAsTable(e)}))}return e.prototype.parseResultsAsSingleStat=function(e){this.output.columns.push({text:"count",type:"number"}),this.output.rows.push([Object(f.toInteger)(e.result.data.result.stats.count)])},e.prototype.parseResultsAsMultiStat=function(e){var t=this;e.result.data.result.forEach((function(a,n){if(0===n&&e&&e.query&&e.query.servicenow&&e.query.servicenow.groupBy&&(e.query.servicenow.groupBy.filter(Boolean).forEach((function(e){t.output.columns.push({text:e,type:"string"})})),t.output.columns.push({text:"count",type:"number"})),a&&a.stats){var r=Object(f.toInteger)(a.stats.count),l=[];e.query.servicenow.groupBy.filter(Boolean).forEach((function(e){var t=a.groupby_fields.find((function(t){return t.field===e}));t&&l.push(t.display_value||t.value||"-")})),l.push(r),t.output.rows.push(l)}}))},e.prototype.parseResultsAsTable=function(e){var t=this;this.output.columns=[];var a=[];a=e&&e.query&&e.query.servicenow&&e.query.servicenow.fields?e.query.servicenow.fields:a,a=e&&e.query&&e.query&&e.query.fields?e.query.fields:a;var n=Object(f.uniq)(a.filter(Boolean).map((function(e){return e.trim()})).filter(Boolean));a&&"*"!==a[0]&&""!==a[0]?e.result.data.result.forEach((function(e,a){0===a&&Object(f.forEach)(n,(function(e){t.output.columns.push({text:e,type:"string"})}));var r=[];t.output.columns.forEach((function(t){var a=e[t.text];"object"===w(a)&&a&&(a.display_value||""===a.value)?r.push(a.display_value||a.value):"object"===w(a)?r.push(JSON.stringify(a)):r.push(a)})),t.output.rows.push(r)})):e.result.data.result.forEach((function(e,a){0===a&&Object(f.forEach)(e,(function(e,a){"object"===w(e)&&e&&(e.display_value||""===e.value)?t.output.columns.push({text:a,type:"string"}):t.output.columns.push({text:a,type:"object"===w(e)?"string":w(e)})}));var n=[];Object(f.forEach)(e,(function(e){"object"===w(e)&&e&&(e.display_value||""===e.value)?n.push(e.display_value||e.value):"object"===w(e)?n.push(JSON.stringify(e)):n.push(e)})),t.output.rows.push(n)}))},e.prototype.getResultsAsAnnotations=function(){var e=this,t=[];return Object(f.forEach)(this.output.rows,(function(a){var n=function(e,t,a){var n={text:"",title:"",tags:[],time:(new Date).getTime()},r="";return Object(f.forEach)(t,(function(t,l){t.text===a.startTimeField?e[l]&&(n.time=new Date(e[l]).getTime(),r+=t.text+" : "+e[l]+"\n"):t.text===a.endTimeField?e[l]&&(n.timeEnd=new Date(e[l]).getTime(),r+=t.text+" : "+e[l]+"\n"):t.text===a.titleField?e[l]&&(n.title=e[l]):t.text===a.descriptionField?e[l]&&(n.text=e[l]):e[l]&&n.tags.push(t.text+" : "+e[l])})),n.text+="\n    "+r+"\n  ",n}(a,e.output.columns,e.query);t.push(n)})),t},e}(),N=function(e,t,a){var n="javascript:gs.dateGenerate('"+t.format("YYYY-MM-DD")+"','"+t.format("HH:mm:ss")+"')",r="javascript:gs.dateGenerate('"+a.format("YYYY-MM-DD")+"','"+a.format("HH:mm:ss")+"')";return e=(e=(e=e.replace("$__timeFrom()",n)).replace("$__timeTo()",r)).replace("$__timeFilter()",n+"@"+r)},q=function(){function e(e,t){this.instanceSettings=e,this.templateSrv=t,this.url=this.instanceSettings.url}return e.prototype.getServiceNowResults=function(e,t){var a=this;void 0===t&&(t=1);var n=this.url+e.getUrl();return Object(l.getBackendSrv)().datasourceRequest({method:"GET",url:n}).catch((function(n){if(console.log(n),t>0)return a.getServiceNowResults(e,t-1);throw n}))},e.prototype.doQueries=function(e,t){var a=this;return e.map((function(e){var n=e.servicenow;n&&n.query&&(n.query=N(n.query,t.range.from,t.range.to),n.query=a.templateSrv.replace(n.query,{},"glob")),n&&n.filters&&(n.filters=n.filters.map((function(e){return e.value=N(e.value,t.range.from,t.range.to),e.value=a.templateSrv.replace(e.value,{},"glob"),e})));var r=new y("",[],"","true",[]);if(e.servicenow&&"table"===e.servicenow.type){var l=e.servicenow;r=new b(l.table,l.fields.map((function(e){return e.trim()})).filter(Boolean),l.query,l.limit,l.filters,l.orderBy,l.orderByDirection)}else if(e.servicenow&&"stats"===e.servicenow.type){l=e.servicenow;r=new y(l.table,l.groupBy.map((function(e){return e.trim()})).filter(Boolean),l.query,"true",l.filters)}return a.getServiceNowResults(r).then((function(a){return{result:a,query:e,options:t}})).catch((function(t){throw{error:t,query:e}}))}))},e.prototype.doAnnotationQueries=function(e,t){var a=this;return e.map((function(e){e.query=N(e.query,t.range.from,t.range.to);var n=new b(e.table,e.fields,e.query,e.limit,[],e.startTimeField,"asc");return a.getServiceNowResults(n).then((function(t){return{result:t,query:e,options:{}}})).catch((function(t){throw{error:t,query:e}}))}))},e.prototype.query=function(e){var t=[];e.targets&&(t=e.targets.filter((function(e){return!0!==e.hide})));var a=this.doQueries(t,e);return Promise.all(a).then((function(e){return new E(e).output}))},e.prototype.annotationsQuery=function(e){var t=[];if(e.targets)t=e.targets.filter((function(e){return!0!==e.hide}));else if(e.annotation){var a={limit:e.annotation.limit||30,startTimeField:e.annotation.startTimeField,endTimeField:e.annotation.endTimeField,titleField:e.annotation.titleField,descriptionField:e.annotation.descriptionField,fields:m(e.annotation.fields.split(","),[e.annotation.titleField,e.annotation.descriptionField,e.annotation.startTimeField,e.annotation.endTimeField]),query:e.annotation.query||"",table:e.annotation.table};t.push(a)}var n=this.doAnnotationQueries(t,e);return Promise.all(n).then((function(e){return new E(e).getResultsAsAnnotations()}))},e}(),C=function(e){function t(t,a){var n=e.call(this,t)||this;return n.instanceSettings=t,n.templateSrv=a,n.serviceNowInstance=new q(n.instanceSettings,n.templateSrv),n}return t.$inject=["instanceSettings","templateSrv"],i(t,e),t.prototype.query=function(e){var t=[],a=Object(f.cloneDeep)(e);if(a.targets.length>0){var n=this.serviceNowInstance.query(a);n&&t.push(n)}return Promise.all(t).then((function(e){return{data:Object(f.flatten)(e)}}))},t.prototype.annotationQuery=function(e){e.annotation.query=this.templateSrv.replace(e.annotation.query,{},"glob");var t={range:e.range,rangeRaw:e.rangeRaw,annotation:e.annotation};return this.serviceNowInstance.annotationsQuery(t).then((function(e){return e})).catch((function(e){return console.error(e),[]}))},t.prototype.metricFindQuery=function(e){return Promise.resolve([])},t.prototype.testDatasource=function(){var e=this;return new Promise((function(t,a){return u(e,void 0,void 0,(function(){var e;return c(this,(function(n){return e=new v("doc","table/schema","",[],"all","","asc"),this.serviceNowInstance.getServiceNowResults(e,0).then((function(e){e&&200===e.status&&e.data&&e.data.result?t({message:"Successfully Connected ServiceNow."+e.data.result.length+" tables found.",status:"success"}):(console.error(e),a({message:"Failed to Connect ServiceNow",status:"error"}))})).catch((function(e){console.error(e),a({message:"Failed to Connect ServiceNow",status:"error"})})),[2]}))}))}))},t}(r.DataSourceApi),S=a(0),_=a.n(S),T=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.onURLChange=function(e){var a=t.props,n=a.onOptionsChange,r=a.options;n(s(s({},r),{url:e.target.value}))},t.onUserNameChange=function(e){var a=t.props,n=a.onOptionsChange,r=a.options;n(s(s({},r),{basicAuthUser:e.target.value}))},t.onPasswordChange=function(e){var a=t.props,n=a.onOptionsChange,r=a.options;n(s(s({},r),{secureJsonData:{basicAuthPassword:e.target.value}}))},t.onResetPassword=function(){var e=t.props,a=e.onOptionsChange,n=e.options;a(s(s({},n),{secureJsonFields:s(s({},n.secureJsonFields),{basicAuthPassword:!1}),secureJsonData:s(s({},n.secureJsonData),{basicAuthPassword:""})}))},t}return i(t,e),t.prototype.render=function(){var e=this.props.options;e.basicAuth=!0;var t=e.secureJsonFields,a=e.secureJsonData||{};return _.a.createElement(_.a.Fragment,null,_.a.createElement("h3",{className:"page-heading"},"Service Now Settings"),_.a.createElement("div",{className:"gf-form-inline"},_.a.createElement("div",{className:"gf-form"},_.a.createElement("label",{className:"gf-form-label width-11",title:"Service Now URL"},"Service Now URL"),_.a.createElement("input",{className:"gf-form-input width-20",type:"text",onChange:this.onURLChange,value:e.url||"",placeholder:"https://YOUR_INSTANCE_NAME.service-now.com"}))),_.a.createElement("div",{className:"gf-form-inline"},_.a.createElement("div",{className:"gf-form"},_.a.createElement("label",{className:"gf-form-label width-11",title:"User Name"},"User name"),_.a.createElement("input",{className:"gf-form-input width-20",type:"text",onChange:this.onUserNameChange,value:e.basicAuthUser||"",placeholder:"username"}))),_.a.createElement("div",{className:"gf-form-inline"},_.a.createElement("div",{className:"gf-form"},_.a.createElement("label",{className:"gf-form-label width-11",title:"Password"},"Password"),t&&t.basicAuthPassword?_.a.createElement(_.a.Fragment,null,_.a.createElement("label",{className:"gf-form-label width-20"},"Configured"),_.a.createElement("span",{className:"gf-form-button btn btn-secondary width-6",onClick:this.onResetPassword},"Reset")):_.a.createElement("input",{type:"password",value:a.basicAuthPassword||"",className:"gf-form-input width-20",onChange:this.onPasswordChange}))))},t}(S.PureComponent),F=function(e,t,a,n){void 0===n&&(n="string");var r=a.query,l=a.onChange,o=r.servicenow;Object(f.set)(o,t,"number"===n?Object(f.toInteger)(e.value):e.value),l(s(s({},r),{servicenow:o}))},O=function(e,t,a,n){void 0===n&&(n=!1);var r=a.query,l=a.onChange,o=r.servicenow,i=n?e.target.value.split(","):e.target.value;Object(f.set)(o,t,i),l(s(s({},r),{servicenow:o}))},R=[{label:"Incidents (INC)",value:"incident",short_code:"INC"},{label:"Change Request (CHG)",value:"change_request",short_code:"CHG"},{label:"Problem (PRB)",value:"problem",short_code:"PRB"}],x=[{label:"Table",value:"table"},{label:"Stats",value:"stats"}],A=[{value:"active",label:"Active",tables:["incident","change_request","problem"]},{value:"assigned_to",label:"Assigned To",tables:["incident","change_request","problem"]},{value:"assignment_group.name",label:"Assignment Group",tables:["incident","change_request","problem"]},{value:"assignment_group",label:"Assignment Group ID",tables:["incident","change_request","problem"]},{value:"description",label:"Description",tables:["incident","change_request","problem"]},{value:"end_date",label:"End Date",tables:["change_request"],FieldType:r.FieldType.time},{value:"incident_state",label:"Incident State",tables:["incident"]},{value:"number",label:"Number",tables:["incident","change_request","problem"]},{value:"opened_at",label:"Opened At",tables:["incident","change_request","problem"],FieldType:r.FieldType.time},{value:"priority",label:"Priority",tables:["incident","change_request","problem"]},{value:"short_description",label:"Short Description",tables:["incident","change_request","problem"]},{value:"start_date",label:"Start Date",tables:["change_request"],FieldType:r.FieldType.time},{value:"state",label:"State",tables:["incident","change_request","problem"]},{value:"sys_created_by",label:"Created By",tables:["incident","change_request","problem"]},{value:"sys_created_on",label:"Created On",tables:["incident","change_request","problem"],FieldType:r.FieldType.time},{value:"urgency",label:"Urgency",tables:["problem"]},{value:"category",label:"Category",tables:["problem"]},{value:"subcategory",label:"Subcategory",tables:["problem"]}],B=A.filter((function(e){return e.FieldType===r.FieldType.time})),P=[{value:"^",label:"AND"},{value:"^OR",label:"OR"}],L=[{value:"=",label:"Equals"},{value:"!=",label:"Not Equals"},{value:"<",label:"Less than"},{value:"<=",label:"Less than or Equals"},{value:">",label:"Greater than"},{value:">=",label:"Greater than or Equals"},{value:"STARTSWITH",label:"Starts With"},{value:"ENDSWITH",label:"Ends With"},{value:"LIKE",label:"Like"},{value:"NOT LIKE",label:"Not Like"},{value:"ISEMPTY",label:"Is Empty"},{value:"ISNOTEMPTY",label:"Is Not Empty"},{value:"IN",label:"In"},{value:"NOT IN",label:"Not In"},{value:"ANYTHING",label:"Anything"},{value:"BETWEEN",label:"Between"},{value:"SAMEAS",label:"Is Same"},{value:"NSAMEAS",label:"Is Different"},{value:"ONToday",label:"On Today"},{value:"NOTONToday",label:"Not On Today"},{value:"DATEPART",label:"Date Part"},{value:"RELATIVEGE",label:"Relative (on or after)"},{value:"RELATIVELE",label:"Relative (on or before)"},{value:"RELATIVEGT",label:"Relative (after)"},{value:"RELATIVELT",label:"Relative (before)"},{value:"RELATIVEEE",label:"Relative (on)"},{value:"MORETHAN",label:"Is More than"},{value:"LESSTHAN",label:"Is Less than"},{value:"GT_FIELD",label:"Greater than field"},{value:"LT_FIELD",label:"Less than field"},{value:"GT_OR_EQUALS_FIELD",label:"Greater than or is field"},{value:"LT_OR_EQUALS_FIELD",label:"Less than or is field"}],j={active:[{label:"True",value:"true"},{label:"False",value:"false"}],grafanaTimestamps:[{label:"Grafana Start Time",value:"$__timeFrom()"},{label:"Grafana End Time",value:"$__timeTo()"},{label:"Grafana Time Range",value:"$__timeFilter()"}]},D=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={showTableSelectorModal:!1,tablesList:[]},t.showHelpModal=function(e){return function(){t.setState({showTableSelectorModal:e})}},t}return i(t,e),t.prototype.chooseTable=function(e){var t=this.props,a=t.query,n=t.onChange,r=a.servicenow;Object(f.set)(r,"table",e),n(s(s({},a),{servicenow:r})),this.setState({showTableSelectorModal:!1})},t.prototype.loadMoreTables=function(){var e=this,t=new q(this.props.datasource.instanceSettings,null),a=new v("doc","table/schema","",[],"all","","asc");t.getServiceNowResults(a).then((function(t){t&&t.data&&t.data.result&&e.setState({tablesList:t.data.result})}))},t.prototype.render=function(){var e=this,t=this.state.showTableSelectorModal;return _.a.createElement(_.a.Fragment,null,_.a.createElement("input",{type:"text",className:"gf-form-label width-8",value:this.props.query.servicenow.table,placeholder:"Table Name",title:"Click to type",onChange:function(t){O(t,"table",e.props)}}),_.a.createElement("label",{role:"button",title:"Click to choose from list",className:"query-keyword gf-form-label width-4",onClick:this.showHelpModal(!0)},"change"),_.a.createElement(n.Modal,{title:_.a.createElement("div",{className:"modal-header-title"},_.a.createElement("span",{className:"p-l-1"},"Tables")),isOpen:t,onDismiss:this.showHelpModal(!1)},_.a.createElement("div",null,_.a.createElement("h4",null,"Popular Tables"),_.a.createElement("table",{style:{width:"100%"}},R.map((function(t){return _.a.createElement("tr",null,_.a.createElement("td",{style:{width:"40%"}},t.label),_.a.createElement("td",{style:{width:"40%"}},t.value),t.value===e.props.query.servicenow.table?_.a.createElement("td",null,_.a.createElement("span",{className:"btn btn-secondary btn-small",style:{margin:"5px"}},"  selected  ")):_.a.createElement("td",null,_.a.createElement("span",{className:"btn btn-success btn-small",style:{margin:"5px"},onClick:function(){return e.chooseTable(t.value)}},"  select  ")))}))),_.a.createElement("br",null),_.a.createElement("br",null),this.state.tablesList.length>0?_.a.createElement("div",null,_.a.createElement("h4",null,"More Tables"),_.a.createElement("table",{style:{width:"100%"}},Object(f.orderBy)(this.state.tablesList,["label"],["asc"]).map((function(t){return _.a.createElement("tr",null,_.a.createElement("td",{style:{width:"40%"}},t.label),_.a.createElement("td",{style:{width:"40%"}},t.value),t.value===e.props.query.servicenow.table?_.a.createElement("td",null,_.a.createElement("span",{className:"btn btn-secondary btn-small",style:{margin:"5px"}},"  selected  ")):_.a.createElement("td",null,_.a.createElement("span",{className:"btn btn-success btn-small",style:{margin:"5px"},onClick:function(){return e.chooseTable(t.value)}},"  select  ")))})))):_.a.createElement("div",{style:{textAlign:"center"}},_.a.createElement("span",{className:"btn btn-secondary btn-medium",style:{margin:"5px"},onClick:function(){return e.loadMoreTables()}},"Load more tables")))))},t}(S.PureComponent),M=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.render=function(){var e=this,t=this.props.query;return _.a.createElement("div",null,_.a.createElement("div",{className:"gf-form-inline"},_.a.createElement("div",{className:"gf-form"},_.a.createElement("label",{className:"gf-form-label width-8"},"Table"),_.a.createElement(D,{onChange:this.props.onChange,query:t,datasource:this.props.datasource})),"    ",_.a.createElement("div",{className:"gf-form"},_.a.createElement("label",{className:"gf-form-label width-6"},"Type"),_.a.createElement(n.Select,{className:"width-11",value:x.find((function(e){return e.value===t.servicenow.type})),options:x,defaultValue:t.servicenow.type,onChange:function(t){return F(t,"type",e.props)}}))))},t}(S.PureComponent),I=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={showFieldsListModal:!1,selectedTable:"",fieldsList:[]},t.showFieldsListModal=function(e){return function(){e&&t.retrieveFieldsList(),t.setState({showFieldsListModal:e})}},t}return i(t,e),t.prototype.retrieveFieldsList=function(e){var t=this;if(void 0===e&&(e=!1),this.props.query.servicenow.table!==this.state.selectedTable||e){this.setState({selectedTable:this.props.query.servicenow.table});var a=new q(this.props.datasource.instanceSettings,null),n=new v("doc","table/schema/"+this.props.query.servicenow.table,"",[],"all","","asc");a.getServiceNowResults(n).then((function(e){e&&e.data&&e.data.result&&t.setState({fieldsList:e.data.result})}))}},t.prototype.addField=function(e){var t=this.props,a=t.query,n=t.onChange,r=a.servicenow;r[this.props.fieldName]=r[this.props.fieldName]||[],r[this.props.fieldName].push(e),n(s(s({},a),{servicenow:r}))},t.prototype.removeField=function(e){var t=this.props,a=t.query,n=t.onChange,r=a.servicenow;r[this.props.fieldName]=r[this.props.fieldName]||[],r[this.props.fieldName]=r[this.props.fieldName].filter((function(t){return t!==e})),n(s(s({},a),{servicenow:r}))},t.prototype.componentWillMount=function(){this.setState({selectedTable:this.props.query.servicenow.table}),this.retrieveFieldsList(!0)},t.prototype.render=function(){var e=this,t=this.state.showFieldsListModal;return _.a.createElement(_.a.Fragment,null," ",_.a.createElement("label",{role:"button",onClick:this.showFieldsListModal(!0),title:"Fields List",className:"query-keyword gf-form-label width-6"},"choose fields"),_.a.createElement(n.Modal,{title:_.a.createElement("div",{className:"modal-header-title"},_.a.createElement("span",{className:"p-l-1"},"Fields List - Table : ",this.state.selectedTable)),isOpen:t,onDismiss:this.showFieldsListModal(!1)},_.a.createElement("div",null,_.a.createElement("table",{style:{width:"100%"}},_.a.createElement("tr",null,_.a.createElement("td",null,"Label"),_.a.createElement("td",null,"Value"),_.a.createElement("td",null,"Type"),_.a.createElement("td",null,"Selected")),Object(f.orderBy)(this.state.fieldsList,["label"],["asc"]).map((function(t){return _.a.createElement("tr",null,_.a.createElement("td",null,t.label),_.a.createElement("td",null,t.name),_.a.createElement("td",null,t.internalType),_.a.createElement("td",null,e.props.query.servicenow[e.props.fieldName].indexOf(t.name)>-1?_.a.createElement("span",{className:"btn btn-danger btn-small",style:{margin:"5px"},onClick:function(){return e.removeField(t.name)}},"remove"):_.a.createElement("span",{className:"btn btn-success btn-small",style:{margin:"5px"},onClick:function(){return e.addField(t.name)}},"  add  ")))}))))))},t}(S.PureComponent),k=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.render=function(){var e=this,t=this.props.query;return _.a.createElement("div",null,_.a.createElement("div",{className:"gf-form-inline"},_.a.createElement("div",{className:"gf-form"},_.a.createElement("label",{className:"gf-form-label width-8",title:"Fields ( Comma separated )"},"Fields"),_.a.createElement("input",{className:"gf-form-input width-24",type:"text",onChange:function(t){return O(t,"fields",e.props,!0)},value:t.servicenow.fields.join(","),placeholder:"Fields ( Comma Separated)",title:"Fields ( Comma Separated )"}),_.a.createElement(I,{onChange:this.props.onChange,query:t,datasource:this.props.datasource,fieldName:"fields"}))))},t}(S.PureComponent),V=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={showHelpModal:!1},t.showHelpModal=function(e){return function(){t.setState({showHelpModal:e})}},t}return i(t,e),t.prototype.render=function(){var e=this.state.showHelpModal;return _.a.createElement(_.a.Fragment,null," ",_.a.createElement("label",{role:"button",onClick:this.showHelpModal(!0),title:"Help",className:"btn btn-secondary btn-small"},"?"),_.a.createElement(n.Modal,{title:_.a.createElement("div",{className:"modal-header-title"},_.a.createElement("span",{className:"p-l-1"},"Service Now Query Help")),isOpen:e,onDismiss:this.showHelpModal(!1)},_.a.createElement("div",null,_.a.createElement("div",null,_.a.createElement("h4",null,"Time Filter"),_.a.createElement("br",null),_.a.createElement("pre",{style:{display:"inline"}},"$__timeFrom()")," Returns the From datetime from the Grafana picker. Can be used with"," ",_.a.createElement("b",null,"Before / After")," filter.",_.a.createElement("br",null),_.a.createElement("br",null),_.a.createElement("pre",{style:{display:"inline"}},"$__timeTo()")," Returns the To datetime from the Grafana picker. Can be used with"," ",_.a.createElement("b",null,"Before / After")," filter.",_.a.createElement("br",null),_.a.createElement("br",null),_.a.createElement("pre",{style:{display:"inline"}},"$__timeFilter()")," Return start and end time form Grafana picker. Can be used with ",_.a.createElement("b",null,"Between")," ","filter.",_.a.createElement("br",null),_.a.createElement("br",null),_.a.createElement("h4",null,"Relative Time"),_.a.createElement("br",null),_.a.createElement("pre",{style:{display:"inline"}},"@hour@ago@24")," Returns the timestamp of 24 hours ago. Can be used with ",_.a.createElement("b",null,"Relative")," filter.",_.a.createElement("br",null),_.a.createElement("br",null),_.a.createElement("pre",{style:{display:"inline"}},"@hour@ago@-24")," Returns the timestamp of 24 hours from now. Can be used with ",_.a.createElement("b",null,"Relative")," ","filter.",_.a.createElement("br",null),_.a.createElement("br",null),_.a.createElement("p",null,"More help can be found at"," ",_.a.createElement("a",{href:"https://docs.servicenow.com/bundle/orlando-platform-user-interface/page/use/common-ui-elements/reference/r_OpAvailableFiltersQueries.html",target:"_blank",rel:"noopener"},"service-now website."))))))},t}(S.PureComponent),G=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.render=function(){var e=this,t=this.props.query;return _.a.createElement("div",null,_.a.createElement("div",{className:"gf-form-inline"},_.a.createElement("div",{className:"gf-form"},_.a.createElement("label",{className:"gf-form-label width-8",title:"Query"},"Query"),_.a.createElement("textarea",{value:t.servicenow.query||"",onChange:function(t){return O(t,"query",e.props)},className:"gf-form-input min-width-28 width-28",rows:3}),_.a.createElement(V,null))))},t}(S.PureComponent),H=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.render=function(){var e=this,t=this.props.query;return _.a.createElement("div",null,_.a.createElement("div",{className:"gf-form-inline"},_.a.createElement("div",{className:"gf-form"},_.a.createElement("label",{className:"gf-form-label width-8",title:"Group By Field"},"Group By"),_.a.createElement("input",{className:"gf-form-input width-24",type:"text",onChange:function(t){return O(t,"groupBy",e.props,!0)},value:t.servicenow.groupBy.join(","),placeholder:"",title:"Group By"}),_.a.createElement(I,{onChange:this.props.onChange,query:t,datasource:this.props.datasource,fieldName:"groupBy"}))))},t}(S.PureComponent),U=[{label:"Ascending",value:"asc"},{label:"Descending",value:"desc"}],Q=[10,25,50,100,250,500,1e3].map((function(e){return{label:e.toString(),value:e.toString()}})),Y=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.render=function(){var e=this,t=this.props.query,a="table"===t.servicenow.type?_.a.createElement(_.a.Fragment,null,_.a.createElement("div",{className:"gf-form-inline"},_.a.createElement("div",{className:"gf-form"},_.a.createElement("label",{className:"gf-form-label width-8",title:"Limit"},"Limit"),_.a.createElement(n.Select,{className:"width-12",value:Q.find((function(e){return e.value===t.servicenow.limit}))||{value:t.servicenow.limit,label:t.servicenow.limit},options:Q,defaultValue:t.servicenow.limit,onChange:function(t){return F(t,"limit",e.props,"number")},allowCustomValue:!0}),"  ",_.a.createElement("label",{className:"gf-form-label width-4",title:"Order By"},"Order By"),_.a.createElement(n.Select,{className:"width-12",value:A.find((function(e){return e.value===t.servicenow.orderBy}))||{value:t.servicenow.orderBy,label:t.servicenow.orderBy},options:A.filter((function(e){return e.tables.indexOf(t.servicenow.table)>-1})),defaultValue:t.servicenow.orderBy,onChange:function(t){return F(t,"orderBy",e.props)},allowCustomValue:!0}),_.a.createElement(n.Select,{className:"width-8",value:U.find((function(e){return e.value===t.servicenow.orderByDirection})),options:U,defaultValue:t.servicenow.orderByDirection,onChange:function(t){return F(t,"orderByDirection",e.props)}})))):null;return _.a.createElement(_.a.Fragment,null,a)},t}(S.PureComponent),$=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.onFilterAdd=function(e){void 0===e&&(e="^");var a=t.props,n=a.query,r=a.onChange,l=n.servicenow,o=new h("number","LIKE","INC",e);l.filters=l.filters||[o],l.filters.push(o),r(s(s({},n),{servicenow:l}))},t.onFilterRemove=function(e){var a=t.props,n=a.query,r=a.onChange,l=n.servicenow,o=new h("active","=","true","^");l.filters=l.filters||[o],l.filters.splice(e,1),r(s(s({},n),{servicenow:l}))},t}return i(t,e),t.prototype.render=function(){var e=this,t=this.props.query;return _.a.createElement("div",null,0===t.servicenow.filters.length?_.a.createElement("div",{className:"gf-form-inline"},_.a.createElement("div",{className:"gf-form"},_.a.createElement("div",{className:"gf-form gf-form--grow"},_.a.createElement("label",{className:"gf-form-label width-8",title:"Filter"},"Filter"))),_.a.createElement("div",{className:"gf-form"},_.a.createElement("div",{className:"gf-form gf-form--grow"},_.a.createElement("span",{className:"btn btn-success btn-small",style:{margin:"5px"},onClick:function(){return e.onFilterAdd("^")}},"Add Filter")))):null,t.servicenow.filters.map((function(a,r){var l;return l=_.a.createElement("input",{type:"text",className:"gf-form-input width-12",title:"Value",placeholder:"Value",value:a.value,onChange:function(t){return O(t,"filters["+r+"].value",e.props)}}),"active"!==a.field||"="!==a.operator&&"!="!==a.operator||(l=_.a.createElement(n.Select,{className:"width-12",value:j.active.find((function(e){return e.value===a.value}))||{value:a.value,label:a.value},options:j.active,defaultValue:"true",onChange:function(t){return F(t,"filters["+r+"].value",e.props)}})),B.map((function(e){return e.value})).indexOf(a.field)>-1&&([">",">=","<","<="].indexOf(a.operator)>-1?l=_.a.createElement(n.Select,{className:"width-12",value:j.grafanaTimestamps.find((function(e){return e.value===a.value}))||{value:a.value,label:a.value},options:j.grafanaTimestamps,defaultValue:"$__timeFrom()",onChange:function(t){return F(t,"filters["+r+"].value",e.props)},allowCustomValue:!0}):["BETWEEN"].indexOf(a.operator)>-1&&(l=_.a.createElement(n.Select,{className:"width-12",value:j.grafanaTimestamps.find((function(e){return e.value===a.value}))||{value:a.value,label:a.value},options:j.grafanaTimestamps,defaultValue:"$__timeFilter()",onChange:function(t){return F(t,"filters["+r+"].value",e.props)},allowCustomValue:!0}))),_.a.createElement("div",{className:"gf-form-inline"},_.a.createElement("div",{className:"gf-form"},_.a.createElement("div",{className:"gf-form gf-form--grow"},_.a.createElement("label",{className:"gf-form-label width-8",title:"Filter"},"Filter ",r+1))),_.a.createElement("div",{className:"gf-form"},_.a.createElement("div",{className:"gf-form gf-form--grow"},_.a.createElement(n.Select,{className:"width-12",value:A.find((function(e){return e.value===a.field}))||{value:a.field,label:a.field},options:A.filter((function(e){return e.tables.indexOf(t.servicenow.table)>-1})),defaultValue:a.field,onChange:function(t){F(t,"filters["+r+"].field",e.props),"active"===t.value?(F({value:"="},"filters["+r+"].operator",e.props),F({value:"true"},"filters["+r+"].value",e.props)):B.map((function(e){return e.value})).indexOf(t.value)>-1?(F({value:">="},"filters["+r+"].operator",e.props),F({value:"$__timeFrom()"},"filters["+r+"].value",e.props)):(F({value:"="},"filters["+r+"].operator",e.props),F({value:""},"filters["+r+"].value",e.props))},allowCustomValue:!0}),_.a.createElement(n.Select,{className:"width-12",value:L.find((function(e){return e.value===a.operator}))||{value:a.operator,label:a.operator},options:L,defaultValue:a.operator,onChange:function(t){return F(t,"filters["+r+"].operator",e.props)},allowCustomValue:!0}),l)),_.a.createElement("span",null,_.a.createElement("div",{className:"gf-form"},_.a.createElement("div",{className:"gf-form gf-form--grow"},r===t.servicenow.filters.length-1?_.a.createElement("span",{className:"btn btn-success btn-small",style:{margin:"5px"},onClick:function(){return e.onFilterAdd("^")}},"+"):_.a.createElement(n.Select,{className:"width-5",value:P.find((function(e){return e.value===(a.condition||"^")})),options:P,defaultValue:a.condition,onChange:function(t){return F(t,"filters["+r+"].condition",e.props)},allowCustomValue:!0}),_.a.createElement("span",{className:"btn btn-danger btn-small",style:{margin:"5px"},onClick:function(){return e.onFilterRemove(r)}},"x")))))})))},t}(S.PureComponent),J=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.render=function(){var e,t=Object(f.defaults)(this.props.query,{servicenow:Object(f.defaults)(this.props.query.servicenow,g)});if(t&&t.servicenow&&t.servicenow.type)switch(t.servicenow.type){case"table":e=_.a.createElement(k,{onChange:this.props.onChange,query:t,datasource:this.props.datasource});break;case"stats":e=_.a.createElement(H,{onChange:this.props.onChange,query:t,datasource:this.props.datasource})}return _.a.createElement("div",null,_.a.createElement(M,{onChange:this.props.onChange,query:t,datasource:this.props.datasource}),e,_.a.createElement(G,{onChange:this.props.onChange,query:t,datasource:this.props.datasource}),_.a.createElement($,{onChange:this.props.onChange,query:t,datasource:this.props.datasource}),_.a.createElement(Y,{onChange:this.props.onChange,query:t,datasource:this.props.datasource}))},t}(S.PureComponent),W=function(){function e(){this.supportedTables=R.map((function(e){return{text:e.label,value:e.value}}))}return e.templateUrl="editors/annotations/annotations.editor.html",e}();a.d(t,"plugin",(function(){return K}));var K=new r.DataSourcePlugin(C).setConfigEditor(T).setQueryEditor(J).setAnnotationQueryCtrl(W)}])}));