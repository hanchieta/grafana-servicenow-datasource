define(["react","lodash","@grafana/data","@grafana/ui","@grafana/runtime"],(function(e,t,a,n,r){return function(e){var t={};function a(n){if(t[n])return t[n].exports;var r=t[n]={i:n,l:!1,exports:{}};return e[n].call(r.exports,r,r.exports,a),r.l=!0,r.exports}return a.m=e,a.c=t,a.d=function(e,t,n){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(a.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)a.d(n,r,function(t){return e[t]}.bind(null,r));return n},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="/",a(a.s=5)}([function(t,a){t.exports=e},function(e,a){e.exports=t},function(e,t){e.exports=a},function(e,t){e.exports=n},function(e,t){e.exports=r},function(e,t,a){"use strict";a.r(t);var n=a(3),r=a(2),l=a(4),s=function(e,t){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a])})(e,t)};function i(e,t){function a(){this.constructor=e}s(e,t),e.prototype=null===t?Object.create(t):(a.prototype=t.prototype,new a)}var o=function(){return(o=Object.assign||function(e){for(var t,a=1,n=arguments.length;a<n;a++)for(var r in t=arguments[a])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};function u(e,t,a,n){return new(a||(a=Promise))((function(r,l){function s(e){try{o(n.next(e))}catch(e){l(e)}}function i(e){try{o(n.throw(e))}catch(e){l(e)}}function o(e){var t;e.done?r(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(s,i)}o((n=n.apply(e,t||[])).next())}))}function c(e,t){var a,n,r,l,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return l={next:i(0),throw:i(1),return:i(2)},"function"==typeof Symbol&&(l[Symbol.iterator]=function(){return this}),l;function i(l){return function(i){return function(l){if(a)throw new TypeError("Generator is already executing.");for(;s;)try{if(a=1,n&&(r=2&l[0]?n.return:l[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,l[1])).done)return r;switch(n=0,r&&(l=[2&l[0],r.value]),l[0]){case 0:case 1:r=l;break;case 4:return s.label++,{value:l[1],done:!1};case 5:s.label++,n=l[1],l=[0];continue;case 7:l=s.ops.pop(),s.trys.pop();continue;default:if(!(r=s.trys,(r=r.length>0&&r[r.length-1])||6!==l[0]&&2!==l[0])){s=0;continue}if(3===l[0]&&(!r||l[1]>r[0]&&l[1]<r[3])){s.label=l[1];break}if(6===l[0]&&s.label<r[1]){s.label=r[1],r=l;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(l);break}r[2]&&s.ops.pop(),s.trys.pop();continue}l=t.call(e,s)}catch(e){l=[6,e],n=0}finally{a=r=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}([l,i])}}}function p(e,t){var a="function"==typeof Symbol&&e[Symbol.iterator];if(!a)return e;var n,r,l=a.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(n=l.next()).done;)s.push(n.value)}catch(e){r={error:e}}finally{try{n&&!n.done&&(a=l.return)&&a.call(l)}finally{if(r)throw r.error}}return s}function f(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(p(arguments[t]));return e}var m=a(1),d=function(){function e(e,t){this.key=e,this.value=t.toString()}return e.prototype.getValue=function(){return[this.key,this.value].join("=")},e}(),v=function(){function e(e,t,a,n){void 0===n&&(n="^"),this.condition=n,this.field=e,this.operator=t,this.value=a}return e.prototype.toString=function(){return(""+this.field+this.operator+this.value).trim()},e}(),h=function(){function e(e,t,a,n,r,l,s){void 0===l&&(l=""),void 0===s&&(s="desc"),this.tableName="",this.queryParams=[],this.api=e,this.tableName=t;var i=[this.getNormalizedSysParmQuery(a)+"^"].filter((function(e){return"^"!==e}));n.forEach((function(e,t){var a=t===n.length-1?"":e.condition||"^";i.push(encodeURIComponent((""+e.field+e.operator+e.value+a).trim()))})),l&&i.push(("asc"===s?"^ORDERBY":"^ORDERBYDESC")+l.trim()),this.queryParams.push(new d("sysparm_query",i.join("").replace(/\^\^/g,"^"))),this.queryParams.push(new d("sysparm_display_value",r))}return e.prototype.getNormalizedSysParmQuery=function(e){return(e+"").trim().replace(/\^OR\n/g,"^OR").replace(/\^\n/g,"^").replace(/\n/g,"^")},e.prototype.getUrl=function(){switch(this.api){case"doc":return"/api/now/doc/"+this.tableName;case"table":return"/api/now/table/"+this.tableName+"?"+this.queryParams.map((function(e){return e.getValue()})).join("&");case"stats":return"/api/now/stats/"+this.tableName+"?"+this.queryParams.map((function(e){return e.getValue()})).join("&")}},e}(),b=function(e){function t(t,a,n,r,l,s,i){void 0===r&&(r=10);var o=e.call(this,"table",t,n,l,"all",s,i)||this;return a.length>0&&a[0]&&"*"!==a[0]&&o.queryParams.push(new d("sysparm_fields",a.join(","))),o.queryParams.push(new d("sysparm_limit",r.toString())),o}return i(t,e),t}(h),g=function(e){function t(t,a,n,r,l){void 0===r&&(r="true");var s=e.call(this,"stats",t,n,l,"all","","asc")||this;return s.queryParams.push(new d("sysparm_group_by",a.join(","))),s.queryParams.push(new d("sysparm_count",r)),s}return i(t,e),t}(h),y=new(function(){function e(e){this.table="incident",this.type="table",this.orderByDirection="asc",this.resultFormat="table",this.table=e.table||"incident",this.type=e.type||"table",this.fields=e.fields||[],this.query=e.query||"",this.filters=e.filters||[],this.orderByDirection=e.orderByDirection||"asc",this.orderBy=e.orderBy||"",this.groupBy=e.groupBy||[],this.limit=e.limit||25,this.resultFormat=e.resultFormat||"table"}return e.prototype.getUrl=function(){if("table"===this.type){var e=(this.fields&&"*"!==this.fields[0]?this.fields||"opened_at,number,short_description,sys_created_by,severity,category,state,priority".split(","):[]).filter(Boolean).map((function(e){return e.trim()}));return new b(this.table,e,this.query,this.limit,this.filters,this.orderBy,this.orderByDirection).getUrl()}if("stats"===this.type){var t=(this.groupBy?this.groupBy:[]).filter(Boolean).map((function(e){return e.trim()}));return new g(this.table,t,this.query,"true",this.filters).getUrl()}return""},e}())({table:"incident",type:"stats",fields:"opened_at,number,short_description,sys_created_by,severity,category,state,priority".split(","),query:"",groupBy:"state".split(","),orderBy:"opened_at",orderByDirection:"desc",limit:10,resultFormat:"table"});function w(e){return(w="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var E=function(){function e(e){var t=this;this.output={columns:[],rows:[],type:"table"},e.filter((function(e){return e&&e.result&&e.result.data&&e.result.data.result})).forEach((function(e){t.query=e.query,e&&e.query&&e.query.servicenow&&"stats"===e.query.servicenow.type?e.result.data.result.stats?t.parseResultsAsSingleStat(e):t.parseResultsAsMultiStat(e):t.parseResultsAsTable(e)}))}return e.prototype.parseResultsAsSingleStat=function(e){this.output.columns.push({text:"count",type:"number"}),this.output.rows.push([Object(m.toInteger)(e.result.data.result.stats.count)])},e.prototype.parseResultsAsMultiStat=function(e){var t=this;e.result.data.result.forEach((function(a,n){if(0===n&&e&&e.query&&e.query.servicenow&&e.query.servicenow.groupBy&&(e.query.servicenow.groupBy.filter(Boolean).forEach((function(e){t.output.columns.push({text:e,type:"string"})})),t.output.columns.push({text:"count",type:"number"})),a&&a.stats){var r=Object(m.toInteger)(a.stats.count),l=[];e.query.servicenow.groupBy.filter(Boolean).forEach((function(e){var t=a.groupby_fields.find((function(t){return t.field===e}));t&&l.push(t.display_value||t.value||"-")})),l.push(r),t.output.rows.push(l)}}))},e.prototype.parseResultsAsTable=function(e){var t=this;this.output.columns=[];var a=[];a=e&&e.query&&e.query.servicenow&&e.query.servicenow.fields?e.query.servicenow.fields:a,a=e&&e.query&&e.query&&e.query.fields?e.query.fields:a;var n=Object(m.uniq)(a.filter(Boolean).map((function(e){return e.trim()})).filter(Boolean));a&&"*"!==a[0]&&""!==a[0]?e.result.data.result.forEach((function(e,a){0===a&&Object(m.forEach)(n,(function(e){t.output.columns.push({text:e,type:"string"})}));var r=[];t.output.columns.forEach((function(t){var a=e[t.text];"object"===w(a)&&a&&(a.display_value||""===a.value)?r.push(a.display_value||a.value):"object"===w(a)?r.push(JSON.stringify(a)):r.push(a)})),t.output.rows.push(r)})):e.result.data.result.forEach((function(e,a){0===a&&Object(m.forEach)(e,(function(e,a){"object"===w(e)&&e&&(e.display_value||""===e.value)?t.output.columns.push({text:a,type:"string"}):t.output.columns.push({text:a,type:"object"===w(e)?"string":w(e)})}));var n=[];Object(m.forEach)(e,(function(e){"object"===w(e)&&e&&(e.display_value||""===e.value)?n.push(e.display_value||e.value):"object"===w(e)?n.push(JSON.stringify(e)):n.push(e)})),t.output.rows.push(n)}))},e.prototype.getResultsAsAnnotations=function(){var e=this,t=[];return Object(m.forEach)(this.output.rows,(function(a){var n=function(e,t,a){var n={text:"",title:"",tags:[],time:(new Date).getTime()},r="",l=a.customDescription||"";return Object(m.forEach)(t,(function(t,s){t.text===a.startTimeField?e[s]&&(n.time=new Date(e[s]).getTime(),r+=t.text+" : "+e[s]+"\n"):t.text===a.endTimeField?e[s]&&(n.timeEnd=new Date(e[s]).getTime(),r+=t.text+" : "+e[s]+"\n"):t.text===a.titleField?e[s]&&(n.title=e[s]):t.text===a.descriptionField?e[s]&&(n.text=e[s]):e[s]&&n.tags.push(t.text+" : "+e[s]),l=(l=l.replace("${__data.fields["+t.text+"]}",e[s])).replace(new RegExp("{field."+t.text+"}","g"),e[s])})),n.text+="\n    "+r+"\n    "+l+"\n  ",n}(a,e.output.columns,e.query);t.push(n)})),t},e}(),N=function(e,t,a){var n="javascript:gs.dateGenerate('"+t.format("YYYY-MM-DD")+"','"+t.format("HH:mm:ss")+"')",r="javascript:gs.dateGenerate('"+a.format("YYYY-MM-DD")+"','"+a.format("HH:mm:ss")+"')";return e=(e=(e=e.replace("$__timeFrom()",n)).replace("$__timeTo()",r)).replace("$__timeFilter()",n+"@"+r)},O=function(){function e(e,t){this.instanceSettings=e,this.templateSrv=t,this.url=this.instanceSettings.url}return e.prototype.getServiceNowResults=function(e,t){var a=this;void 0===t&&(t=1);var n=this.url+e.getUrl();return Object(l.getBackendSrv)().datasourceRequest({method:"GET",url:n}).catch((function(n){if(console.log(n),t>0)return a.getServiceNowResults(e,t-1);throw n}))},e.prototype.doQueries=function(e,t){var a=this;return e.map((function(e){var n=e.servicenow;n&&n.query&&(n.query=N(n.query,t.range.from,t.range.to),n.query=a.templateSrv.replace(n.query,{},"csv")),n&&n.filters&&(n.filters=n.filters.map((function(e){return e.value=N(e.value,t.range.from,t.range.to),e.value=a.templateSrv.replace(e.value,{},"csv"),e})));var r=new g("",[],"","true",[]);if(e.servicenow&&"table"===e.servicenow.type){var l=e.servicenow;r=new b(l.table,l.fields.map((function(e){return e.trim()})).filter(Boolean),l.query,l.limit,l.filters,l.orderBy,l.orderByDirection)}else if(e.servicenow&&"stats"===e.servicenow.type){l=e.servicenow;r=new g(l.table,l.groupBy.map((function(e){return e.trim()})).filter(Boolean),l.query,"true",l.filters)}return a.getServiceNowResults(r).then((function(a){return{result:a,query:e,options:t}})).catch((function(t){throw{error:t,query:e}}))}))},e.prototype.doAnnotationQueries=function(e,t){var a=this;return e.map((function(e){e.query=N(e.query,t.range.from,t.range.to);var n=new b(e.table,e.fields,e.query,e.limit,[],e.startTimeField,"asc");return a.getServiceNowResults(n).then((function(t){return{result:t,query:e,options:{}}})).catch((function(t){throw{error:t,query:e}}))}))},e.prototype.query=function(e){var t=[];e.targets&&(t=e.targets.filter((function(e){return!0!==e.hide})));var a=this.doQueries(t,e);return Promise.all(a).then((function(e){return new E(e).output}))},e.prototype.annotationsQuery=function(e){var t=[];if(e.targets)t=e.targets.filter((function(e){return!0!==e.hide}));else if(e.annotation){var a="";e.annotation.startTimeField&&(a=[e.annotation.startTimeField+"BETWEEN$__timeFilter()",e.annotation.query].filter(Boolean).join("^"));var n={limit:e.annotation.limit||30,startTimeField:e.annotation.startTimeField,endTimeField:e.annotation.endTimeField,titleField:e.annotation.titleField,descriptionField:e.annotation.descriptionField,customDescription:e.annotation.customDescription||"",fields:f((e.annotation.fields||"").split(","),[e.annotation.titleField,e.annotation.descriptionField,e.annotation.startTimeField,e.annotation.endTimeField]),query:a,table:e.annotation.table};t.push(n)}var r=this.doAnnotationQueries(t,e);return Promise.all(r).then((function(e){return new E(e).getResultsAsAnnotations()}))},e}(),T=function(e){function t(t,a){var n=e.call(this,t)||this;return n.instanceSettings=t,n.templateSrv=a,n.serviceNowInstance=new O(n.instanceSettings,n.templateSrv),n}return t.$inject=["instanceSettings","templateSrv"],i(t,e),t.prototype.query=function(e){var t=[],a=Object(m.cloneDeep)(e),n=e&&e.targets&&e.targets[0]&&e.targets[0].servicenow&&"timeseries"===e.targets[0].servicenow.resultFormat;if(a.targets.length>0){var r=this.serviceNowInstance.query(a);r&&t.push(r)}return Promise.all(t).then((function(t){if(n){var a=[];return t.forEach((function(t){t.rows.forEach((function(t){var n=t.map((function(e,a){return a===t.length-1?"":e})).filter(Boolean).join(" - ")||"",r=Object(m.last)(t);a.push({target:n,datapoints:[[r,e.range.to]]})}))})),{data:a}}return{data:Object(m.flatten)(t)}}))},t.prototype.annotationQuery=function(e){e.annotation.query=this.templateSrv.replace(e.annotation.query,{},"csv");var t={range:e.range,rangeRaw:e.rangeRaw,annotation:e.annotation};return this.serviceNowInstance.annotationsQuery(t).then((function(e){return e})).catch((function(e){return console.error(e),[]}))},t.prototype.metricFindQuery=function(e){if(!e)return Promise.resolve([]);if(e&&e.startsWith("list(")&&e.endsWith(")")){var t=e.replace("list(","").slice(0,-1).split(","),a=t[0],n=t[1],r=t.filter((function(e,t){return t>1})).join(","),l=new g(a,[n],r,"true",[]);return this.serviceNowInstance.getServiceNowResults(l).then((function(e){return Promise.resolve(e.data.result.map((function(e){return{text:e&&e.groupby_fields&&e.groupby_fields[0]?e.groupby_fields[0].display_value||e.groupby_fields[0].value:"",value:e&&e.groupby_fields&&e.groupby_fields[0]?e.groupby_fields[0].value:""}})))})).catch((function(e){return console.error(e),Promise.resolve([])}))}return Promise.resolve([])},t.prototype.testDatasource=function(){var e=this;return new Promise((function(t,a){return u(e,void 0,void 0,(function(){var e;return c(this,(function(n){return e=new h("doc","table/schema","",[],"all","","asc"),this.serviceNowInstance.getServiceNowResults(e,0).then((function(e){e&&200===e.status&&e.data&&e.data.result?t({message:"Successfully Connected ServiceNow."+e.data.result.length+" tables found.",status:"success"}):(console.error(e),a({message:"Failed to Connect ServiceNow",status:"error"}))})).catch((function(e){console.error(e),a({message:"Failed to Connect ServiceNow",status:"error"})})),[2]}))}))}))},t}(r.DataSourceApi),L=a(0),C=a.n(L),q=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.onURLChange=function(e){var a=t.props,n=a.onOptionsChange,r=a.options;n(o(o({},r),{url:e.target.value}))},t.onUserNameChange=function(e){var a=t.props,n=a.onOptionsChange,r=a.options;n(o(o({},r),{basicAuthUser:e.target.value}))},t.onPasswordChange=function(e){var a=t.props,n=a.onOptionsChange,r=a.options;n(o(o({},r),{secureJsonData:{basicAuthPassword:e.target.value}}))},t.onResetPassword=function(){var e=t.props,a=e.onOptionsChange,n=e.options;a(o(o({},n),{secureJsonFields:o(o({},n.secureJsonFields),{basicAuthPassword:!1}),secureJsonData:o(o({},n.secureJsonData),{basicAuthPassword:""})}))},t}return i(t,e),t.prototype.render=function(){var e=this.props.options;e.basicAuth=!0;var t=e.secureJsonFields,a=e.secureJsonData||{};return C.a.createElement(C.a.Fragment,null,C.a.createElement("h3",{className:"page-heading"},"Service Now Settings"),C.a.createElement("div",{className:"gf-form-inline"},C.a.createElement("div",{className:"gf-form"},C.a.createElement("label",{className:"gf-form-label width-11",title:"Service Now URL"},"Service Now URL"),C.a.createElement("input",{className:"gf-form-input width-20",type:"text",onChange:this.onURLChange,value:e.url||"",placeholder:"https://YOUR_INSTANCE_NAME.service-now.com"}))),C.a.createElement("div",{className:"gf-form-inline"},C.a.createElement("div",{className:"gf-form"},C.a.createElement("label",{className:"gf-form-label width-11",title:"User Name"},"User name"),C.a.createElement("input",{className:"gf-form-input width-20",type:"text",onChange:this.onUserNameChange,value:e.basicAuthUser||"",placeholder:"username"}))),C.a.createElement("div",{className:"gf-form-inline"},C.a.createElement("div",{className:"gf-form"},C.a.createElement("label",{className:"gf-form-label width-11",title:"Password"},"Password"),t&&t.basicAuthPassword?C.a.createElement(C.a.Fragment,null,C.a.createElement("label",{className:"gf-form-label width-20"},"Configured"),C.a.createElement("span",{className:"gf-form-button btn btn-secondary width-6",onClick:this.onResetPassword},"Reset")):C.a.createElement("input",{type:"password",value:a.basicAuthPassword||"",className:"gf-form-input width-20",onChange:this.onPasswordChange}))))},t}(L.PureComponent),j=function(e,t,a,n){void 0===n&&(n="string");var r=a.query,l=a.onChange,s=r.servicenow;Object(m.set)(s,t,"number"===n?Object(m.toInteger)(e.value):e.value),l(o(o({},r),{servicenow:s}))},S=function(e,t,a,n){void 0===n&&(n=!1);var r=a.query,l=a.onChange,s=r.servicenow,i=n?e.target.value.split(","):e.target.value;Object(m.set)(s,t,i),l(o(o({},r),{servicenow:s}))},_=[{label:"Incidents (INC)",value:"incident",short_code:"INC"},{label:"Change Request (CHG)",value:"change_request",short_code:"CHG"},{label:"Problem (PRB)",value:"problem",short_code:"PRB"}],F=[{label:"Table",value:"table"},{label:"Stats",value:"stats"}],x=[{label:"Table",value:"table"},{label:"Time Series",value:"timeseries"}],M=[{value:"active",label:"Active",tables:["incident","change_request","problem"]},{value:"assigned_to",label:"Assigned To",tables:["incident","change_request","problem"]},{value:"assignment_group.name",label:"Assignment Group",tables:["incident","change_request","problem"]},{value:"assignment_group",label:"Assignment Group ID",tables:["incident","change_request","problem"]},{value:"description",label:"Description",tables:["incident","change_request","problem"]},{value:"end_date",label:"End Date",tables:["change_request"],FieldType:r.FieldType.time},{value:"incident_state",label:"Incident State",tables:["incident"]},{value:"number",label:"Number",tables:["incident","change_request","problem"]},{value:"opened_at",label:"Opened At",tables:["incident","change_request","problem"],FieldType:r.FieldType.time},{value:"priority",label:"Priority",tables:["incident","change_request","problem"]},{value:"short_description",label:"Short Description",tables:["incident","change_request","problem"]},{value:"start_date",label:"Start Date",tables:["change_request"],FieldType:r.FieldType.time},{value:"state",label:"State",tables:["incident","change_request","problem"]},{value:"sys_created_by",label:"Created By",tables:["incident","change_request","problem"]},{value:"sys_created_on",label:"Created On",tables:["incident","change_request","problem"],FieldType:r.FieldType.time},{value:"urgency",label:"Urgency",tables:["problem"]},{value:"category",label:"Category",tables:["problem"]},{value:"subcategory",label:"Subcategory",tables:["problem"]}],A=M.filter((function(e){return e.FieldType===r.FieldType.time})),R=[{value:"^",label:"AND"},{value:"^OR",label:"OR"}],P=[{value:"=",label:"Equals"},{value:"!=",label:"Not Equals"},{value:"<",label:"Less than"},{value:"<=",label:"Less than or Equals"},{value:">",label:"Greater than"},{value:">=",label:"Greater than or Equals"},{value:"STARTSWITH",label:"Starts With"},{value:"ENDSWITH",label:"Ends With"},{value:"LIKE",label:"Like"},{value:"NOT LIKE",label:"Not Like"},{value:"ISEMPTY",label:"Is Empty"},{value:"ISNOTEMPTY",label:"Is Not Empty"},{value:"IN",label:"In"},{value:"NOT IN",label:"Not In"},{value:"ANYTHING",label:"Anything"},{value:"BETWEEN",label:"Between"},{value:"SAMEAS",label:"Is Same"},{value:"NSAMEAS",label:"Is Different"},{value:"ON",label:"On"},{value:"ONToday",label:"On Today"},{value:"NOTONToday",label:"Not On Today"},{value:"DATEPART",label:"Date Part"},{value:"RELATIVEGE",label:"Relative (on or after)"},{value:"RELATIVELE",label:"Relative (on or before)"},{value:"RELATIVEGT",label:"Relative (after)"},{value:"RELATIVELT",label:"Relative (before)"},{value:"RELATIVEEE",label:"Relative (on)"},{value:"MORETHAN",label:"Is More than"},{value:"LESSTHAN",label:"Is Less than"},{value:"GT_FIELD",label:"Greater than field"},{value:"LT_FIELD",label:"Less than field"},{value:"GT_OR_EQUALS_FIELD",label:"Greater than or is field"},{value:"LT_OR_EQUALS_FIELD",label:"Less than or is field"}],B={active:[{label:"True",value:"true"},{label:"False",value:"false"}],grafanaTimestamps:[{label:"Grafana Start Time",value:"$__timeFrom()"},{label:"Grafana End Time",value:"$__timeTo()"},{label:"Grafana Time Range",value:"$__timeFilter()"},{label:"Today",value:"Today@javascript:gs.beginningOfToday()@javascript:gs.endOfToday()"},{label:"Yesterday",value:"Yesterday@javascript:gs.beginningOfYesterday()@javascript:gs.endOfYesterday()"},{label:"Tomorrow",value:"Tomorrow@javascript:gs.beginningOfTomorrow()@javascript:gs.endOfTomorrow()"},{label:"This week",value:"This week@javascript:gs.beginningOfThisWeek()@javascript:gs.endOfThisWeek()"},{label:"Last week",value:"Last week@javascript:gs.beginningOfLastWeek()@javascript:gs.endOfLastWeek()"},{label:"Next week",value:"Next week@javascript:gs.beginningOfNextWeek()@javascript:gs.endOfNextWeek()"},{label:"This month",value:"This month@javascript:gs.beginningOfThisMonth()@javascript:gs.endOfThisMonth()"},{label:"Last month",value:"Last month@javascript:gs.beginningOfLastMonth()@javascript:gs.endOfLastMonth()"},{label:"Next month",value:"Next month@javascript:gs.beginningOfNextMonth()@javascript:gs.endOfNextMonth()"},{label:"Last 3 months",value:"Last 3 months@javascript:gs.beginningOfLast3Months()@javascript:gs.endOfLast3Months()"},{label:"Last 6 months",value:"Last 6 months@javascript:gs.beginningOfLast6Months()@javascript:gs.endOfLast6Months()"},{label:"Last 9 months",value:"Last 9 months@javascript:gs.beginningOfLast9Months()@javascript:gs.endOfLast9Months()"},{label:"Last 12 months",value:"Last 12 months@javascript:gs.beginningOfLast12Months()@javascript:gs.endOfLast12Months()"},{label:"This quarter",value:"This quarter@javascript:gs.beginningOfThisQuarter()@javascript:gs.endOfThisQuarter()"},{label:"Last quarter",value:"Last quarter@javascript:gs.beginningOfLastQuarter()@javascript:gs.endOfLastQuarter()"},{label:"Last 2 quarters",value:"Last 2 quarters@javascript:gs.beginningOfLast2Quarters()@javascript:gs.endOfLast2Quarters()"},{label:"Next quarter",value:"Next quarter@javascript:gs.beginningOfNextQuarter()@javascript:gs.endOfNextQuarter()"},{label:"Next 2 quarters",value:"Next 2 quarters@javascript:gs.beginningOfNext2Quarters()@javascript:gs.endOfNext2Quarters()"},{label:"This year",value:"This year@javascript:gs.beginningOfThisYear()@javascript:gs.endOfThisYear()"},{label:"Last year",value:"Last year@javascript:gs.beginningOfLastYear()@javascript:gs.endOfLastYear()"},{label:"Next year",value:"Next year@javascript:gs.beginningOfNextYear()@javascript:gs.endOfNextYear()"},{label:"Last 2 years",value:"Last 2 years@javascript:gs.beginningOfLast2Years()@javascript:gs.endOfLast2Years()"},{label:"Last 7 days",value:"Last 7 days@javascript:gs.beginningOfLast7Days()@javascript:gs.endOfLast7Days()"},{label:"Last 30 days",value:"Last 30 days@javascript:gs.beginningOfLast30Days()@javascript:gs.endOfLast30Days()"},{label:"Last 60 days",value:"Last 60 days@javascript:gs.beginningOfLast60Days()@javascript:gs.endOfLast60Days()"},{label:"Last 90 days",value:"Last 90 days@javascript:gs.beginningOfLast90Days()@javascript:gs.endOfLast90Days()"},{label:"Last 120 days",value:"Last 120 days@javascript:gs.beginningOfLast120Days()@javascript:gs.endOfLast120Days()"},{label:"Current hour",value:"Current hour@javascript:gs.beginningOfCurrentHour()@javascript:gs.endOfCurrentHour()"},{label:"Last hour",value:"Last hour@javascript:gs.beginningOfLastHour()@javascript:gs.endOfLastHour()"},{label:"Last 2 hours",value:"Last 2 hours@javascript:gs.beginningOfLast2Hours()@javascript:gs.endOfLast2Hours()"},{label:"Current minute",value:"Current minute@javascript:gs.beginningOfCurrentMinute()@javascript:gs.endOfCurrentMinute()"},{label:"Last minute",value:"Last minute@javascript:gs.beginningOfLastMinute()@javascript:gs.endOfLastMinute()"},{label:"Last 15 minutes",value:"Last 15 minutes@javascript:gs.beginningOfLast15Minutes()@javascript:gs.endOfLast15Minutes()"},{label:"Last 30 minutes",value:"Last 30 minutes@javascript:gs.beginningOfLast30Minutes()@javascript:gs.endOfLast30Minutes()"},{label:"Last 45 minutes",value:"Last 45 minutes@javascript:gs.beginningOfLast45Minutes()@javascript:gs.endOfLast45Minutes()"},{label:"One year ago",value:"One year ago@javascript:gs.beginningOfOneYearAgo()@javascript:gs.endOfOneYearAgo()"}]},D=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={showTableSelectorModal:!1,tablesList:[]},t.showHelpModal=function(e){return function(){t.setState({showTableSelectorModal:e})}},t}return i(t,e),t.prototype.chooseTable=function(e){var t=this.props,a=t.query,n=t.onChange,r=a.servicenow;Object(m.set)(r,"table",e),n(o(o({},a),{servicenow:r})),this.setState({showTableSelectorModal:!1})},t.prototype.loadMoreTables=function(){var e=this,t=new O(this.props.datasource.instanceSettings,null),a=new h("doc","table/schema","",[],"all","","asc");t.getServiceNowResults(a).then((function(t){t&&t.data&&t.data.result&&e.setState({tablesList:t.data.result})}))},t.prototype.render=function(){var e=this,t=this.state.showTableSelectorModal;return C.a.createElement(C.a.Fragment,null,C.a.createElement("input",{type:"text",className:"gf-form-input width-8",value:this.props.query.servicenow.table,placeholder:"Table Name. If you don't know the table name, click 'change' option",title:"Table Name. If you don't know the table name, click 'change' option",onChange:function(t){S(t,"table",e.props)}}),C.a.createElement("label",{role:"button",title:"Click to choose from list",className:"query-keyword gf-form-label width-4",onClick:this.showHelpModal(!0)},"change"),C.a.createElement(n.Modal,{title:C.a.createElement("div",{className:"modal-header-title"},C.a.createElement("span",{className:"p-l-1"},"Tables")),isOpen:t,onDismiss:this.showHelpModal(!1)},C.a.createElement("div",null,C.a.createElement("h4",null,"Popular Tables"),C.a.createElement("table",{style:{width:"100%"}},_.map((function(t){return C.a.createElement("tr",null,C.a.createElement("td",{style:{width:"40%"}},t.label),C.a.createElement("td",{style:{width:"40%"}},t.value),t.value===e.props.query.servicenow.table?C.a.createElement("td",null,C.a.createElement("span",{className:"btn btn-secondary btn-small",style:{margin:"5px"}},"  selected  ")):C.a.createElement("td",null,C.a.createElement("span",{className:"btn btn-success btn-small",style:{margin:"5px"},onClick:function(){return e.chooseTable(t.value)}},"  select  ")))}))),C.a.createElement("br",null),C.a.createElement("br",null),this.state.tablesList.length>0?C.a.createElement("div",null,C.a.createElement("h4",null,"More Tables"),C.a.createElement("table",{style:{width:"100%"}},Object(m.orderBy)(this.state.tablesList,["label"],["asc"]).map((function(t){return C.a.createElement("tr",null,C.a.createElement("td",{style:{width:"40%"}},t.label),C.a.createElement("td",{style:{width:"40%"}},t.value),t.value===e.props.query.servicenow.table?C.a.createElement("td",null,C.a.createElement("span",{className:"btn btn-secondary btn-small",style:{margin:"5px"}},"  selected  ")):C.a.createElement("td",null,C.a.createElement("span",{className:"btn btn-success btn-small",style:{margin:"5px"},onClick:function(){return e.chooseTable(t.value)}},"  select  ")))})))):C.a.createElement("div",{style:{textAlign:"center"}},C.a.createElement("span",{className:"btn btn-secondary btn-medium",style:{margin:"5px"},onClick:function(){return e.loadMoreTables()}},"Load more tables")))))},t}(L.PureComponent),k=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.render=function(){var e=this,t=this.props.query;return C.a.createElement("div",null,C.a.createElement("div",{className:"gf-form-inline"},C.a.createElement("div",{className:"gf-form"},C.a.createElement("label",{className:"gf-form-label width-8"},"Table"),C.a.createElement(D,{onChange:this.props.onChange,query:t,datasource:this.props.datasource})),"    ",C.a.createElement("div",{className:"gf-form"},C.a.createElement("label",{className:"gf-form-label width-6"},"Type"),C.a.createElement(n.Select,{className:"width-11",value:F.find((function(e){return e.value===t.servicenow.type})),options:F,defaultValue:t.servicenow.type,onChange:function(t){return j(t,"type",e.props)}}))))},t}(L.PureComponent),I=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={showFieldsListModal:!1,selectedTable:"",fieldsList:[]},t.showFieldsListModal=function(e){return function(){e&&t.retrieveFieldsList(),t.setState({showFieldsListModal:e})}},t}return i(t,e),t.prototype.retrieveFieldsList=function(e){var t=this;if(void 0===e&&(e=!1),this.props.query.servicenow.table!==this.state.selectedTable||e){this.setState({selectedTable:this.props.query.servicenow.table});var a=new O(this.props.datasource.instanceSettings,null),n=new h("doc","table/schema/"+this.props.query.servicenow.table,"",[],"all","","asc");a.getServiceNowResults(n).then((function(e){e&&e.data&&e.data.result&&t.setState({fieldsList:e.data.result})}))}},t.prototype.addField=function(e){var t=this.props,a=t.query,n=t.onChange,r=a.servicenow;r[this.props.fieldName]=r[this.props.fieldName]||[],r[this.props.fieldName].push(e),n(o(o({},a),{servicenow:r}))},t.prototype.removeField=function(e){var t=this.props,a=t.query,n=t.onChange,r=a.servicenow;r[this.props.fieldName]=r[this.props.fieldName]||[],r[this.props.fieldName]=r[this.props.fieldName].filter((function(t){return t!==e})),n(o(o({},a),{servicenow:r}))},t.prototype.componentWillMount=function(){this.setState({selectedTable:this.props.query.servicenow.table}),this.retrieveFieldsList(!0)},t.prototype.render=function(){var e=this,t=this.state.showFieldsListModal;return C.a.createElement(C.a.Fragment,null," ",C.a.createElement("label",{role:"button",onClick:this.showFieldsListModal(!0),title:"Fields List",className:"query-keyword gf-form-label width-6"},"choose fields"),C.a.createElement(n.Modal,{title:C.a.createElement("div",{className:"modal-header-title"},C.a.createElement("span",{className:"p-l-1"},"Fields List - Table : ",this.state.selectedTable)),isOpen:t,onDismiss:this.showFieldsListModal(!1)},C.a.createElement("div",null,C.a.createElement("table",{style:{width:"100%"}},C.a.createElement("tr",null,C.a.createElement("td",null,"Label"),C.a.createElement("td",null,"Value"),C.a.createElement("td",null,"Type"),C.a.createElement("td",null,"Selected")),Object(m.orderBy)(this.state.fieldsList,["label"],["asc"]).map((function(t){return C.a.createElement("tr",null,C.a.createElement("td",null,t.label),C.a.createElement("td",null,t.name),C.a.createElement("td",null,t.internalType),C.a.createElement("td",null,e.props.query.servicenow[e.props.fieldName].indexOf(t.name)>-1?C.a.createElement("span",{className:"btn btn-danger btn-small",style:{margin:"5px"},onClick:function(){return e.removeField(t.name)}},"remove"):C.a.createElement("span",{className:"btn btn-success btn-small",style:{margin:"5px"},onClick:function(){return e.addField(t.name)}},"  add  ")))}))))))},t}(L.PureComponent),Q=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.render=function(){var e=this,t=this.props.query;return C.a.createElement("div",null,C.a.createElement("div",{className:"gf-form-inline"},C.a.createElement("div",{className:"gf-form"},C.a.createElement("label",{className:"gf-form-label width-8",title:"Fields ( Comma separated )"},"Fields"),C.a.createElement("input",{className:"gf-form-input width-24",type:"text",onChange:function(t){return S(t,"fields",e.props,!0)},value:t.servicenow.fields.join(","),placeholder:"Fields ( Comma Separated)",title:"Fields ( Comma Separated )"}),C.a.createElement(I,{onChange:this.props.onChange,query:t,datasource:this.props.datasource,fieldName:"fields"}))))},t}(L.PureComponent),V=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={showHelpModal:!1},t.showHelpModal=function(e){return function(){t.setState({showHelpModal:e})}},t}return i(t,e),t.prototype.render=function(){var e=this.state.showHelpModal;return C.a.createElement(C.a.Fragment,null," ",C.a.createElement("label",{role:"button",onClick:this.showHelpModal(!0),title:"Help",className:"btn btn-secondary btn-small",style:{marginTop:"4px",padding:"10px"}},C.a.createElement("i",{className:"fa fa-question fa-large btn btn-small"})),C.a.createElement(n.Modal,{title:C.a.createElement("div",{className:"modal-header-title"},C.a.createElement("span",{className:"p-l-1"},"Service Now Query Help")),isOpen:e,onDismiss:this.showHelpModal(!1)},C.a.createElement("div",null,C.a.createElement("div",null,C.a.createElement("h4",null,"Time Filter"),C.a.createElement("br",null),C.a.createElement("pre",{style:{display:"inline"}},"$__timeFrom()")," Returns the From datetime from the Grafana picker. Can be used with"," ",C.a.createElement("b",null,"Before / After")," filter.",C.a.createElement("br",null),C.a.createElement("br",null),C.a.createElement("pre",{style:{display:"inline"}},"$__timeTo()")," Returns the To datetime from the Grafana picker. Can be used with"," ",C.a.createElement("b",null,"Before / After")," filter.",C.a.createElement("br",null),C.a.createElement("br",null),C.a.createElement("pre",{style:{display:"inline"}},"$__timeFilter()")," Return start and end time form Grafana picker. Can be used with ",C.a.createElement("b",null,"Between")," ","filter.",C.a.createElement("br",null),C.a.createElement("br",null),C.a.createElement("h4",null,"Relative Time"),C.a.createElement("br",null),C.a.createElement("pre",{style:{display:"inline"}},"@hour@ago@24")," Returns the timestamp of 24 hours ago. Can be used with ",C.a.createElement("b",null,"Relative")," filter.",C.a.createElement("br",null),C.a.createElement("br",null),C.a.createElement("pre",{style:{display:"inline"}},"@hour@ago@-24")," Returns the timestamp of 24 hours from now. Can be used with ",C.a.createElement("b",null,"Relative")," ","filter.",C.a.createElement("br",null),C.a.createElement("br",null),C.a.createElement("p",null,"More help can be found at"," ",C.a.createElement("a",{href:"https://docs.servicenow.com/bundle/orlando-platform-user-interface/page/use/common-ui-elements/reference/r_OpAvailableFiltersQueries.html",target:"_blank",rel:"noopener"},"service-now website."))))))},t}(L.PureComponent),H=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={showAdvancedQueryModal:!1},t.showAdvancedQueryModal=function(e){return function(){t.setState({showAdvancedQueryModal:e})}},t}return i(t,e),t.prototype.render=function(){var e=this,t=this.props.query,a=this.state.showAdvancedQueryModal;return C.a.createElement(C.a.Fragment,null,C.a.createElement("label",{className:"gf-form-label width-8",title:"Query"},"Query"),C.a.createElement("input",{value:t.servicenow.query||"",type:"text",onChange:function(t){return S(t,"query",e.props)},className:"gf-form-input min-width-24 width-24",title:"Can be blank. This is for advance use cases. Only use when filters are not sufficient.",placeholder:"Can be blank. This is for advance use cases. Only use when filters are not sufficient."})," ",C.a.createElement("label",{role:"button",onClick:this.showAdvancedQueryModal(!0),title:"Advanced Query",className:"btn btn-secondary btn-small",style:{marginTop:"4px",padding:"10px"}},C.a.createElement("i",{className:"fa fa-expand fa-large btn btn-small"})),C.a.createElement(n.Modal,{title:C.a.createElement("div",{className:"modal-header-title"},C.a.createElement("span",{className:"p-l-1"},"Service Now Advanced Query")),isOpen:a,onDismiss:this.showAdvancedQueryModal(!1)},C.a.createElement("textarea",{value:t.servicenow.query||"",onChange:function(t){return S(t,"query",e.props)},className:"gf-form-input min-width-28 width-28",rows:10}),C.a.createElement("br",null),C.a.createElement("span",{className:"btn btn-success btn-small",style:{marginTop:"5px"},onClick:function(){return e.setState({showAdvancedQueryModal:!1})}},"OK")))},t}(L.PureComponent),Y=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.render=function(){var e=this.props.query;return C.a.createElement("div",null,C.a.createElement("div",{className:"gf-form-inline"},C.a.createElement("div",{className:"gf-form"},C.a.createElement(H,{onChange:this.props.onChange,query:e,datasource:this.props.datasource}),C.a.createElement(V,null))))},t}(L.PureComponent),G=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.render=function(){var e=this,t=this.props.query;return C.a.createElement("div",null,C.a.createElement("div",{className:"gf-form-inline"},C.a.createElement("div",{className:"gf-form"},C.a.createElement("label",{className:"gf-form-label width-8",title:"Group By Field"},"Group By"),C.a.createElement("input",{className:"gf-form-input width-24",type:"text",onChange:function(t){return S(t,"groupBy",e.props,!0)},value:t.servicenow.groupBy.join(","),placeholder:"Comma separated fields list. Use 'Choose' option if you don't know the field names",title:"Comma separated fields list. Use 'Choose' option if you don't know the field names"}),C.a.createElement(I,{onChange:this.props.onChange,query:t,datasource:this.props.datasource,fieldName:"groupBy"}))))},t}(L.PureComponent),U=[{label:"Ascending",value:"asc"},{label:"Descending",value:"desc"}],W=[10,25,50,100,250,500,1e3].map((function(e){return{label:e.toString(),value:e.toString()}})),$=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.render=function(){var e=this,t=this.props.query,a="table"===t.servicenow.type?C.a.createElement(C.a.Fragment,null,C.a.createElement("div",{className:"gf-form-inline"},C.a.createElement("div",{className:"gf-form"},C.a.createElement("label",{className:"gf-form-label width-8",title:"Order By"},"Order By"),C.a.createElement(n.Select,{className:"width-12",value:M.find((function(e){return e.value===t.servicenow.orderBy}))||{value:t.servicenow.orderBy,label:t.servicenow.orderBy},options:M.filter((function(e){return e.tables.indexOf(t.servicenow.table)>-1})),defaultValue:t.servicenow.orderBy,onChange:function(t){return j(t,"orderBy",e.props)},allowCustomValue:!0}),C.a.createElement(n.Select,{className:"width-8",value:U.find((function(e){return e.value===t.servicenow.orderByDirection})),options:U,defaultValue:t.servicenow.orderByDirection,onChange:function(t){return j(t,"orderByDirection",e.props)}}),"  ",C.a.createElement("label",{className:"gf-form-label width-4",title:"Limit"},"Limit"),C.a.createElement(n.Select,{className:"width-6",value:W.find((function(e){return e.value===t.servicenow.limit}))||{value:t.servicenow.limit,label:t.servicenow.limit},options:W,defaultValue:t.servicenow.limit,onChange:function(t){return j(t,"limit",e.props,"number")},allowCustomValue:!0}),"  "))):C.a.createElement("div",{className:"gf-form-inline"},C.a.createElement("div",{className:"gf-form"},C.a.createElement("label",{className:"gf-form-label width-8",title:"Result Format"},"Result Format"),C.a.createElement(n.Select,{className:"width-6",value:x.find((function(e){return e.value===t.servicenow.resultFormat}))||{value:t.servicenow.resultFormat||"table",label:t.servicenow.resultFormat||"Table"},options:x,defaultValue:t.servicenow.resultFormat,onChange:function(t){return j(t,"resultFormat",e.props)},allowCustomValue:!0})));return C.a.createElement(C.a.Fragment,null,a)},t}(L.PureComponent),J=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.onFilterAdd=function(e){void 0===e&&(e="^");var a=t.props,n=a.query,r=a.onChange,l=n.servicenow,s=new v("active","=","true",e);l.filters=l.filters||[s],l.filters.push(s),r(o(o({},n),{servicenow:l}))},t.onFilterRemove=function(e){var a=t.props,n=a.query,r=a.onChange,l=n.servicenow,s=new v("active","=","true","^");l.filters=l.filters||[s],l.filters.splice(e,1),r(o(o({},n),{servicenow:l}))},t}return i(t,e),t.prototype.render=function(){var e=this,t=this.props.query;return C.a.createElement("div",null,0===t.servicenow.filters.length?C.a.createElement("div",{className:"gf-form-inline"},C.a.createElement("div",{className:"gf-form"},C.a.createElement("div",{className:"gf-form gf-form--grow"},C.a.createElement("label",{className:"gf-form-label width-8",title:"Filter"},"Filter"))),C.a.createElement("div",{className:"gf-form"},C.a.createElement("div",{className:"gf-form gf-form--grow"},C.a.createElement("span",{className:"btn btn-success btn-small",style:{marginTop:"5px"},onClick:function(){return e.onFilterAdd("^")}},"Add Filter")))):null,t.servicenow.filters.map((function(a,r){var l;return l=C.a.createElement("input",{type:"text",className:"gf-form-input width-12",title:"Value",placeholder:"Value",value:a.value,onChange:function(t){return S(t,"filters["+r+"].value",e.props)}}),"active"!==a.field||"="!==a.operator&&"!="!==a.operator||(l=C.a.createElement(n.Select,{className:"width-12",value:B.active.find((function(e){return e.value===a.value}))||{value:a.value,label:a.value},options:B.active,defaultValue:"true",onChange:function(t){return j(t,"filters["+r+"].value",e.props)}})),A.map((function(e){return e.value})).indexOf(a.field)>-1&&([">",">=","<","<=","ON"].indexOf(a.operator)>-1?l=C.a.createElement(n.Select,{className:"width-12",value:B.grafanaTimestamps.find((function(e){return e.value===a.value}))||{value:a.value,label:a.value},options:B.grafanaTimestamps,defaultValue:"$__timeFrom()",onChange:function(t){return j(t,"filters["+r+"].value",e.props)},allowCustomValue:!0}):["BETWEEN"].indexOf(a.operator)>-1&&(l=C.a.createElement(n.Select,{className:"width-12",value:B.grafanaTimestamps.find((function(e){return e.value===a.value}))||{value:a.value,label:a.value},options:B.grafanaTimestamps,defaultValue:"$__timeFilter()",onChange:function(t){return j(t,"filters["+r+"].value",e.props)},allowCustomValue:!0}))),C.a.createElement("div",{className:"gf-form-inline"},C.a.createElement("div",{className:"gf-form"},C.a.createElement("label",{className:"gf-form-label width-8",title:"Filter"},"Filter ",r+1),C.a.createElement(n.Select,{className:"width-12",value:M.find((function(e){return e.value===a.field}))||{value:a.field,label:a.field},options:M.filter((function(e){return e.tables.indexOf(t.servicenow.table)>-1})),defaultValue:a.field,onChange:function(t){j(t,"filters["+r+"].field",e.props),"active"===t.value?(j({value:"="},"filters["+r+"].operator",e.props),j({value:"true"},"filters["+r+"].value",e.props)):A.map((function(e){return e.value})).indexOf(t.value)>-1?(j({value:">="},"filters["+r+"].operator",e.props),j({value:"$__timeFrom()"},"filters["+r+"].value",e.props)):(j({value:"="},"filters["+r+"].operator",e.props),j({value:""},"filters["+r+"].value",e.props))},allowCustomValue:!0}),C.a.createElement(n.Select,{className:"width-12",value:P.find((function(e){return e.value===a.operator}))||{value:a.operator,label:a.operator},options:P,defaultValue:a.operator,onChange:function(t){return j(t,"filters["+r+"].operator",e.props)},allowCustomValue:!0}),l,r===t.servicenow.filters.length-1?C.a.createElement("span",{className:"btn btn-success btn-small",style:{margin:"5px"},onClick:function(){return e.onFilterAdd("^")}},"+"):C.a.createElement(n.Select,{className:"width-5",value:R.find((function(e){return e.value===(a.condition||"^")})),options:R,defaultValue:a.condition,onChange:function(t){return j(t,"filters["+r+"].condition",e.props)},allowCustomValue:!0}),C.a.createElement("span",{className:"btn btn-danger btn-small",style:{margin:"5px"},onClick:function(){return e.onFilterRemove(r)}},"x")))})))},t}(L.PureComponent),K=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.render=function(){var e,t=Object(m.defaults)(this.props.query,{servicenow:Object(m.defaults)(this.props.query.servicenow,y)});if(t&&t.servicenow&&t.servicenow.type)switch(t.servicenow.type){case"table":e=C.a.createElement(Q,{onChange:this.props.onChange,query:t,datasource:this.props.datasource});break;case"stats":e=C.a.createElement(G,{onChange:this.props.onChange,query:t,datasource:this.props.datasource})}return C.a.createElement("div",null,C.a.createElement(k,{onChange:this.props.onChange,query:t,datasource:this.props.datasource}),e,C.a.createElement(Y,{onChange:this.props.onChange,query:t,datasource:this.props.datasource}),C.a.createElement(J,{onChange:this.props.onChange,query:t,datasource:this.props.datasource}),C.a.createElement($,{onChange:this.props.onChange,query:t,datasource:this.props.datasource}))},t}(L.PureComponent),z=function(){function e(){this.supportedTables=_.map((function(e){return{text:e.label,value:e.value}}))}return e.templateUrl="editors/annotations/annotations.editor.html",e}();a.d(t,"plugin",(function(){return X}));var X=new r.DataSourcePlugin(T).setConfigEditor(q).setQueryEditor(K).setAnnotationQueryCtrl(z)}])}));